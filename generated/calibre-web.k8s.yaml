apiVersion: v1
kind: Namespace
metadata:
  name: calibre-web
---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: calibre-web
  namespace: flux-system
spec:
  interval: 1m0s
  type: oci
  url: oci://tccr.io/truecharts
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: calibre-web-helm-val-calibre-web-c8a0bd39
  namespace: calibre-web
data:
  values.yaml: |-
    # https://github.com/truecharts/charts/blob/master/charts/stable/calibre-web/values.yaml

    persistence:
      config:
        enabled: true
        size: 1Gi
        storageClass: longhorn-crypto-global
        mountPath: /config
      books:
        enabled: true
        size: 64Gi
        storageClass: longhorn-crypto-global
        mountPath: /books

    ingress:
      main:
        enabled: true
        ingressClassName: traefik
        hosts:
          - host: books.services.mkz.me
          - host: lib.iop.cx
        tls:
          - hosts:
            - books.services.mkz.me
            - lib.iop.cx
            secretName: tls-books-crt

        integrations:
          certManager:
            enabled: true
            certificateIssuer: "letsencrypt-prod"
          traefik:
            enabled: true
            entrypoints:
              - websecure
            enableFixedMiddlewares: false
            forceTLS: true
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  annotations:
    configMapHash: a9400d096875d189d1e555c37e20e6d4d66721f70706aac4a55245d85deb0ff1
  name: calibre-web
  namespace: calibre-web
spec:
  chart:
    spec:
      chart: calibre-web
      sourceRef:
        kind: HelmRepository
        name: calibre-web
        namespace: flux-system
      version: 20.2.8
  install:
    createNamespace: false
    skipCRDs: false
  interval: 10m0s
  timeout: 5m0s
  values: {}
  valuesFrom:
    - kind: ConfigMap
      name: calibre-web-helm-val-calibre-web-c8a0bd39
      valuesKey: values.yaml
